vars:
  step_count: &step_count 100  # MCTS search steps
  time_limit: &time_limit 86400 # 24 hrs

defaults: &defaults
  start: mlmaster/start.sh
  dockerfile: mlmaster/Dockerfile
  kwargs_type: omegaconf
  env_vars: &env_vars
    TIME_LIMIT_SECS: *time_limit
    STEP_LIMIT: *step_count

kwargs_common: &kwargs_common
  agent.search.max_debug_depth: 20 # debug down a branch for up to 20 steps
  agent.search.debug_prob: 1 # always debug when there's something to debug
  agent.time_limit: *time_limit
  exec.timeout: 32400 # 9 hours limit _per step_, to match max of kaggle.com
  copy_data: False # use symbolic links
  agent.check_format: True # enable format validation
  agent.save_all_submission: True # keep all submissions for grading

mlmaster:
  start: mlmaster/start.sh
  dockerfile: mlmaster/Dockerfile
  kwargs_type: omegaconf
  env_vars:
    TIME_LIMIT_SECS: 86400  # 24 hrs
    STEP_LIMIT: 100
  kwargs:
    agent.search.max_debug_depth: 20
    agent.search.debug_prob: 1
    agent.time_limit: 86400  # 24 hours
    agent.steps: 100
    agent.code.model: gpt-4o-2024-08-06
    agent.feedback.model: gpt-4o-2024-08-06
    exec.timeout: 32400  # 9 hours limit per step
    copy_data: false
    agent.check_format: true
  env_vars:
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    TIME_LIMIT_SECS: 86400
    STEP_LIMIT: 100

mlmaster/dev:
  start: mlmaster/start.sh
  dockerfile: mlmaster/Dockerfile
  kwargs_type: omegaconf
  kwargs:
    agent.code.model: gpt-4o-2024-08-06
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: 8
    agent.time_limit: 3600  # 1 hour for dev testing
    agent.search.max_debug_depth: 20
    agent.search.debug_prob: 1
    exec.timeout: 1800  # 30 minutes per step for dev
    copy_data: False
    agent.check_format: True
  env_vars:
    TIME_LIMIT_SECS: 3600  # 1 hour for dev
    STEP_LIMIT: 8
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}

mlmaster/qwen3:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: qwen/qwq-32b-preview
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: *step_count
    agent.steerable_reasoning: True
  env_vars:
    <<: *env_vars
    OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

mlmaster/deepseek-r1:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: deepseek-reasoner
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: *step_count
    agent.steerable_reasoning: True
  env_vars:
    <<: *env_vars
    DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

mlmaster/gpt-5:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-5-mini
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: *step_count
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

mlmaster/dev:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-4o-2024-08-06
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: 8
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

# Experiment variations based on ML-Master features
mlmaster/post-search-on:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-4o-2024-08-06
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: *step_count
    post_search.enabled: True
    post_search.selection_mode: "cv_robust"
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

mlmaster/plan-constraints:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-4o-2024-08-06
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: *step_count
    plan_constraints.enabled: True
    plan_constraints.max_sentences: 5
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

mlmaster/bug-consultant:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-4o-2024-08-06
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: *step_count
    agent.search.use_bug_consultant: True
    agent.search.bug_context_mode: consultant
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

mlmaster/dev:
  <<: *defaults
  kwargs:
    <<: *kwargs_common
    agent.code.model: gpt-4o-2024-08-06
    agent.feedback.model: gpt-4o-2024-08-06
    agent.steps: 8
  env_vars:
    <<: *env_vars
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
